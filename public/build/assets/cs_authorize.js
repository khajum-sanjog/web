$(document).ready(function(){const r=$("#cardNumber"),i=$("#expDate"),u=$("#cvc"),p=$("#google_pay_container");if(r.data("formattingAttached")||(r.on("input",function(){let e=$(this).val().replace(/\D/g,"");e=(e.match(/.{1,4}/g)||[]).join(" "),$(this).val(e.slice(0,23))}),r.data("formattingAttached",!0)),i.data("formattingAttached")||(i.on("input",function(){let e=$(this).val().replace(/\D/g,"");e.length>2&&(e=e.slice(0,2)+"/"+e.slice(2,4)),$(this).val(e.slice(0,5))}),i.data("formattingAttached",!0)),$("#btnSubmit").click(function(e){e.preventDefault();const t=$(this),a=$("#btnSpinner"),n=$("#btnText");return t.prop("disabled",!0).addClass("opacity-70 cursor-not-allowed"),n.text("Processing..."),a.removeClass("hidden"),new Promise(s=>{const m=r.val().replace(/\s/g,""),g=i.val().trim(),y=u.val().trim(),o=$("#paymentErrors");if(!/^\d{13,19}$/.test(m)){o.text("Invalid card number. Please enter a valid card number (13-19 digits).").show(),t.prop("disabled",!1).removeClass("opacity-70 cursor-not-allowed"),n.text("PAY NOW"),a.addClass("hidden");return}if(!/^\d{2}\/\d{2}$/.test(g)){o.text("Invalid expiration date. Please use MM/YY format.").show(),t.prop("disabled",!1).removeClass("opacity-70 cursor-not-allowed"),n.text("PAY NOW"),a.addClass("hidden");return}const[h,f]=g.split("/"),C=new Date,v=C.getFullYear()%100,D=C.getMonth()+1,c=parseInt(h,10),b=parseInt(f,10);if(c<1||c>12){o.length&&o.text("Invalid month. Please enter a month between 01 and 12.").show(),s({error:"Invalid month"}),t.prop("disabled",!1).removeClass("opacity-70 cursor-not-allowed"),n.text("PAY NOW"),a.addClass("hidden");return}if(b<v||b===v&&c<D){o.length&&o.text("Card has expired. Please use a valid expiration date.").show(),s({error:"Card has expired"}),t.prop("disabled",!1).removeClass("opacity-70 cursor-not-allowed"),n.text("PAY NOW"),a.addClass("hidden");return}if(!/^\d{3,4}$/.test(y)){o.length&&o.text("Invalid CVC. Please enter a 3- or 4-digit code.").show(),s({error:"Invalid CVC"}),t.prop("disabled",!1).removeClass("opacity-70 cursor-not-allowed"),n.text("PAY NOW"),a.addClass("hidden");return}var I={authData:{apiLoginID:$("meta[name='auth_login_id']").attr("content"),clientKey:$("meta[name='client_key']").attr("content")},cardData:{cardNumber:m,month:h,year:"20"+f,cardCode:y}};Accept.dispatchData(I,function(l){var w,P;if(console.log("main_response",l),l.messages.resultCode==="Error"){const d=JSON.stringify({status:"error",message:((P=(w=d.messages.message)==null?void 0:w[0])==null?void 0:P.text)||"Payment system configuration error. Please contact support."});document.title=d,t.prop("disabled",!1).removeClass("opacity-70 cursor-not-allowed"),n.text("PAY NOW"),a.addClass("hidden"),console.log("errorMessage",errorMessage)}else{const d=window.btoa(l.opaqueData.dataValue);r.value="",i.value="",u.value="";const x=JSON.stringify({status:"success",data:{token:d,descriptor:l.opaqueData.dataDescriptor}});console.log("response",x),document.title=x}})})}),p.length){const e={apiVersion:2,apiVersionMinor:0},t={type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],allowedCardNetworks:["AMEX","DISCOVER","MASTERCARD","VISA"]},tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:{gateway:$("meta[name='user_gateway']").attr("content"),gatewayMerchantId:$("meta[name='user_gateway_merchant_id']").attr("content")}}},a=new window.google.payments.api.PaymentsClient({environment:"TEST"}),n={...e,allowedPaymentMethods:[t]};a.isReadyToPay(n).then(s=>{s.result?A():document.getElementById("google-pay-button-{$instanceId}").innerHTML="Google Pay not available"}).catch(s=>{document.getElementById("google-pay-error-{$instanceId}").innerText="Google Pay unavailable: "+s.message,document.getElementById("google-pay-error-{$instanceId}").style.display="block"})}function A(){const e=new window.google.payments.api.PaymentsClient({environment:"TEST"}),t=p,a=e.createButton({onClick:()=>onGooglePayClicked(e),buttonType:"buy",buttonColor:"black",buttonSizeMode:"fill",buttonRadius:4});t.empty().append(a)}});
